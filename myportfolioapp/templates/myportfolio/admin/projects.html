{% extends "myportfolio/admin/nav.html" %}
{% load static %}

{% block title %}Projects{% endblock %}

{% block content %}
<div class="container-fluid mt-4">

  <h2 class="mb-4">Projects</h2>

  <!-- Add / Update Project Form -->
  <div class="card shadow-sm mb-5">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">{% if project %}Update Project{% else %}Add Project{% endif %}</h5>
    </div>
    <div class="card-body">
      <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}

        <!-- Project Title -->
        <div class="mb-3">
          <label for="title" class="form-label fw-bold">Project Title</label>
          <input type="text" class="form-control" id="title" name="title" placeholder="Enter project title"
                 value="{% if project %}{{ project.title }}{% endif %}" required>
        </div>

        <!-- Description -->
        <div class="mb-3">
          <label for="description" class="form-label fw-bold">Description</label>
          <textarea class="form-control" id="description" name="description" rows="4"
                    placeholder="Enter project description" required>{% if project %}{{ project.description }}{% endif %}</textarea>
        </div>

        <!-- Technologies -->
        <div class="mb-3">
          <label for="technologies" class="form-label fw-bold">Technologies Used</label>
          <input type="text" class="form-control" id="technologies" name="technologies"
                 placeholder="Python, Django, Bootstrap..."
                 value="{% if project %}{{ project.technologies }}{% endif %}" required>
        </div>

        <!-- Project Image -->
        <div class="mb-3">
          <label for="image" class="form-label fw-bold">Project Image</label>
          <input type="file" class="form-control" id="image" name="image" {% if not project %}required{% endif %}>
          {% if project and project.image %}
          <img src="{{ project.image.url }}" alt="{{ project.title }}" class="img-thumbnail mt-2" width="150">
          {% endif %}
        </div>

        <!-- GitHub Link -->
        <div class="mb-3">
          <label for="github_link" class="form-label fw-bold">GitHub Link</label>
          <input type="url" class="form-control" id="github_link" name="github_link"
                 value="{% if project %}{{ project.github_link }}{% endif %}" placeholder="https://github.com/...">
        </div>

        <!-- Live Link -->
        <div class="mb-3">
          <label for="live_link" class="form-label fw-bold">Live Link</label>
          <input type="url" class="form-control" id="live_link" name="live_link"
                 value="{% if project %}{{ project.live_link }}{% endif %}" placeholder="https://...">
        </div>

        <!-- Submit Button -->
        <button type="submit" class="btn btn-primary">{% if project %}Update{% else %}Add{% endif %}</button>
      </form>
    </div>
  </div>

  <!-- Existing Projects Table -->
  <div class="card shadow-sm">
    <div class="card-header bg-dark text-white">
      <h5 class="mb-0">All Projects</h5>
    </div>
    <div class="card-body table-responsive">
      <table class="table table-bordered table-hover">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Title</th>
            <th>Technologies</th>
            <th>Image</th>
            <th>GitHub</th>
            <th>Live Link</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for p in all_projects %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ p.title }}</td>
            <td>{{ p.technologies }}</td>
            <td>
              {% if p.image %}
              <img src="{{ p.image.url }}" alt="{{ p.title }}" width="80" class="img-thumbnail">
              {% endif %}
            </td>
            <td>
              {% if p.github_link %}
              <a href="{{ p.github_link }}" target="_blank" class="btn btn-sm btn-outline-secondary">GitHub</a>
              {% endif %}
            </td>
            <td>
              {% if p.live_link %}
              <a href="{{ p.live_link }}" target="_blank" class="btn btn-sm btn-outline-success">Live</a>
              {% endif %}
            </td>
            <td>
              <a href="{% url 'edit_project' p.id %}" class="btn btn-sm btn-primary">Edit</a>
              <a href="{% url 'delete_project' p.id %}" class="btn btn-sm btn-danger"
                 onclick="return confirm('Are you sure you want to delete this project?');">Delete</a>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" class="text-center">No projects added yet.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

</div>
{% endblock %}
